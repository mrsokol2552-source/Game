# Дополнение к плану разработки игры: Экономика, логистика и фортификации

## 1) Ресурсы и базовые правила (MUST)
1. Ввести **4 базовых ресурса**:
   - **Труда-часы (LaborHours)** мирного населения — универсальный производственный ресурс.
   - **Энергия (Power)** — объём электро-генерации/потребления за сутки.
   - **Материалы (Materials)** — стройматериалы/детали/боекомплект (унифицированно).
   - **Еда (Food)** — снабжение гражданских и военных.
2. **Суточный тик** экономики: расчёт происходит раз в игровой день в строго определённом порядке (см. §9).
3. Для каждого здания задать: **стоимость постройки**, **время строительства**, **штатную потребность в труда-часах**, **потребление/выработку энергии**, **обслуживание**, **прирост/переработку ресурсов**.
4. Нельзя уходить в минус по ресурсам. При дефиците система **автоматически снижает приоритетные расходы** (см. §10).

## 2) Рост населения и конверсия в военных (MUST)
1. Ввести **общий суточный прирост** мирного населения `CivGrowth` (ед./день).
2. Прирост формирует **пул свободных гражданских** (в труда-часах: `LaborHours = CivFree * HoursPerCivPerDay`).
3. Постройками типа **Призывной пункт/Казармы** конвертировать часть прироста в **военных**:
   - Параметры конверсии: **лимит обучаемых в день**, **время подготовки**, **стоимость в еде/материалах/энергии/труда-часах**.
   - Итог: военный юнит поступает в резерв/гарнизон после завершения обучения.

## 3) Передача процентов суточного прироста ИИ (MUST)
1. Для каждого ресурса (включая **CivGrowth**) добавить **слайдер % передачи ИИ** (0–100%, шаг 1%).
2. Передача применяется **к чистому суточному приросту** до поступления в склад игрока.
3. Округление вниз до целых; остаток остаётся у игрока.
4. Конфиг хранить помодно: **общие проценты** + возможность **переписать по фракции ИИ** (при наличии нескольких ИИ).

## 4) Типы зданий (MUST)
1. **Экономические**: Электростанция, Ферма, Шахта/Завод, Склад/Аккумулятор.
2. **Исследовательские**: Лаборатория/Университет — открывают апгрейды, повышают эффективность.
3. **Производственные юнитов**: Казармы/Завод техники/Аэродром — создают боевые юниты, требуют материалы, энергию, труда-часы и еду на содержании.

## 5) Транспорт как механика, не прямое управление (MUST)
1. Ввести **логистические узлы** (Город/Станция/Порт/Аэродром) и **коридоры** (дорога/железная дорога/воздушный мост).
2. Игрок создаёт **приказы переброски**: «откуда-куда», **приоритет**, **цель прибытия**.
3. Система считает **время в пути** с учётом пропускной способности коридоров и узких мест; юниты перемещаются **автоматически**.
4. Поддержать **резервирование транспорта** (авто-маршрутизация, перенос очереди) и **ускоренную переброску** с повышенным расходом ресурсов.

## 6) Возведение фортификаций юнитами (MUST)
1. Разделить на **временные** (окоп, пункт наблюдения, мешки с песком) и **постоянные** (ДОТ/бункер, капонир, противотанковый ров/ежи).
2. Каждой позиции задать: **стоимость** (труда-часы, материалы, иногда энергия), **время постройки**, **уровень защиты/укрытия**, **обслуживание/депрекация**.
3. Инструменты строительства:
   - **Линейное строительство** (траншеи по полилинии).
   - **Узловые точки** (опорники, башни, огневые точки).
   - **Улучшения/модернизации** (временное → постоянное).
4. Стройка идёт **инженерными юнитами**; параллельность определяется числом бригад/инструмента.

## 7) Интерфейс управления (MUST)
1. **Экран экономики/суточного отчёта**: баланс ресурсов, узкие места, очереди.
2. **Панель процентов передачи ИИ**: 5 слайдеров (LaborHours, Power, Materials, Food, CivGrowth), кнопка «сброс/по умолчанию».
3. **Строительное меню**: фильтры по типам зданий, требования, окупаемость, место размещения.
4. **Логистика**: список приказов переброски, статусы, ETA, «ускорить».
5. **Фортификации**: инструменты линии/точки, стоимость/время в реальном времени, очередь задач.

## 8) Данные/конфиг (JSON, no YAML) (MUST)
Пример (сокращённо):
{
  "economy": {
    "dailyTickHour": 0,
    "transferToAI": { "laborHoursPct": 0, "powerPct": 0, "materialsPct": 0, "foodPct": 0, "civGrowthPct": 0 }
  },
  "population": {
    "civilians": 10000,
    "baseDailyGrowth": 45,
    "hoursPerCivPerDay": 8
  },
  "buildings": [
    { "id": "farm_t1", "type": "economic", "buildTimeDays": 3, "cost": {"materials": 120}, "powerIn": 5, "laborIn": 10, "foodOut": 60 },
    { "id": "barracks_t1", "type": "unit_prod", "buildTimeDays": 4, "cost": {"materials": 200}, "powerIn": 10, "laborIn": 20,
      "convert": { "civPerDay": 20, "trainDays": 2, "costPerRecruit": {"food": 2, "materials": 1} } }
  ],
  "logistics": {
    "nodes": [{"id": "city_A","type": "rail"},{"id": "front_N","type": "front"}],
    "links": [{"from":"city_A","to":"front_N","mode":"rail","capacityUnitsPerDay":50,"baseHours":6}]
  },
  "fortifications": [
    { "id":"foxhole","category":"temporary","labor":4,"materials":2,"buildHours":6,"cover":"light" },
    { "id":"bunker","category":"permanent","labor":40,"materials":120,"powerIn":2,"buildDays":5,"cover":"heavy" }
  ]
}

## 9) Порядок суточного тика (MUST)
1. **Рост населения** → рассчёт `CivGrowth`.
2. **Передача % ИИ** по `CivGrowth` и ресурсам (на приросте).
3. **Потребление базовое** (еда населения, содержание войск/зданий, потери на хранение).
4. **Производство зданий** (еда, материалы, энергия, труда-часы).
5. **Очереди строительства/обучения** (списываем труд/материалы/энергию, продвигаем прогресс).
6. **Логистика** (обновление статусов перебросок, прибытия/выбытия).
7. **Фортификации** (прогресс стройки/ремонта/износа).
8. **Отчёт/алерты** (дефициты, простаивающие мощности, забитые коридоры).

## 10) Дефициты и приоритеты (MUST)
1. Ввести **приоритетные очереди**: 1) содержание населения/войск, 2) электропитание «жизненно важного», 3) еда военным, 4) производство, 5) исследования, 6) ускоренная логистика.
2. При нехватке **энергии** — пошаговое отключение по приоритетам; при нехватке **еды** — падение `CivGrowth` до 0 и рост риска событий (бунты/дезертирство), при длительном голоде — убывание населения.
3. Никаких «скрытых» списаний — всё видно в суточном отчёте.

## 11) Транспорт: детали реализации (SHOULD)
1. **Алгоритм пути**: кратчайшее время с ограничением по **capacityUnitsPerDay** и очередям.
2. Режим **Rush**: +50% скорость, +X% расход энергии/материалов.
3. **Авто-маршруты**: игрок задаёт «домашние» узлы для армий; пополнение идёт по умолчанию.

## 12) Фортификации: детали (SHOULD)
1. **Пакетные заказы**: линия траншей длиной L → стоимость пропорциональна L; разделение задачи между доступными инженерными бригадами.
2. **Деградация**: временные позиции теряют эффективность/прочность со временем и под огнём; постоянные — медленнее и ремонтопригодны.
3. **Апгрейд пути**: временная → капитальная без полного демонтажа (частичный зачёт уже вложенных труда-часов/материалов).

## 13) Баланс и контроль (SHOULD)
1. Встроить **тест-сценарии**: 
   - «Энергоголод»: отключения работают по приоритетам; экономика не падает в ноль.
   - «Мобилизация»: X% CivGrowth → войска; проверка узких мест по еде/материалам.
   - «Логистический пик»: массовая переброска не ломает коридоры; ETA корректны.
2. Метрики: **средняя загрузка мощностей**, **время простоя**, **узкие места по ресурсу/узлу**.

## 14) Минимально жизнеспособный срез (MVP) (MUST)
1. Суточный тик, 4 ресурса, один тип экономического здания (Ферма), одна Казарма, базовая передача % ИИ.
2. Логистика: 2 узла + 1 коридор, переброска пехотного юнита.
3. Фортификации: один временный (окоп) и один постоянный (бункер) тип.
4. Экран отчёта и слайдеры % передачи.

## 15) Технические константы (SHOULD)
- Все расчёты — **целочисленные**; доли — фикс. точность (×1000) с последующим округлением вниз при записи.
- Детерминированность тика: один источник случайности, сид, повторяемость.

---

### Критерии готовности (DoD)
- Все пункты **MUST** реализованы и покрыты автотестами сценариев; интерфейсы (слайдеры %, экран отчёта, логистика, стройка фортификаций) работают и отражают реальные списания/приросты.
- Нет скрытых расходов, нет отрицательных значений, понятные сообщения при дефицитах.
